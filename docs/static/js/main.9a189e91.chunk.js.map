{"version":3,"sources":["theme.ts","settings.ts","constants.ts","store.ts","data/cameras.ts","data/showers.ts","data/stations.ts","data/meteors.ts","ui/AppMenu.tsx","ui/MeteorInfo.tsx","data/GMN.ts","GMNProvider.tsx","ui/LoadDailyMeteorsDialog.tsx","ui/filter/ShowerFilter.tsx","ui/filter/MagnitudeFilter.tsx","ui/filter/StationPrefixFilter.tsx","ui/filter/StationFilter.tsx","ui/Filter.tsx","ui/Settings.tsx","3d/geometry.ts","ui/MeteorTooltip.tsx","3d/InstancedMeteors.tsx","3d/CameraControls.tsx","3d/Globe.tsx","App.tsx","index.tsx"],"names":["theme","createTheme","palette","mode","SETTINGS","DEFAULT_SETTINGS","showClouds","light","cityLights","saveSettings","settings","localStorage","setItem","JSON","stringify","EARTH_RADIUS","MIN_MAGNITUDE","MAX_MAGNITUDE","DEFAULT_UP","DEFAULT_CAMERA_CONTROL","target","up","minDistance","maxDistance","CITY_LIGHTS_COLOR","Color","enableMapSet","store","Store","highlightedMarker","markers","Map","identifier","latitude","longitude","label","loading","meteorDataInfo","url","title","meteors","selectedMeteor","undefined","activeShowers","stationsByCode","stations","filter","showers","magnitude","min","max","codes","prefixes","cameraControl","s","getItem","parse","e","console","error","loadSettings","a","fetch","response","ok","text","csv","records","columns","map","r","camera_id","obs_latitude","obs_longitude","Promise","reject","statusText","initCameras","loadCameras","then","cameras","update","m","c","set","catch","require","showersByCode","code","SPORADIC_CODE","SPORADIC","name","numMeteors","getShower","get","u","isSporadic","shower","buildActiveShowers","meteor","activeShower","push","values","sort","b","length","initStations","activeStationCodes","Set","stationCodes","has","add","localeCompare","info","METEORS_YESTERDAY","METEORS_LATEST_DAILY","fetchMeteorData","async","nextIndex","line","slice","fields","split","i","f","trim","parseFloat","beginTime","showerCode","begin","height","end","averageSpeed","duration","peakHeight","mass","index","fetchline","AppMenu","props","anchorEl","open","onClose","onLoadMeteors","showLoadDailyDialog","resetView","Menu","MenuItem","onClick","Divider","MeteorInfo","focusMeteor","Box","className","Stack","direction","sx","justifyContent","alignItems","Tooltip","IconButton","join","URL_BASE","DAILY_URL_REGEX","GMN","_dailyFileNamesByDate","_dailyInitialized","filename","date","d","toFormat","this","Error","toLocaleString","DateTime","DATE_FULL","dailyMeteorsUrl","ms","matchAll","groups","Context","createContext","GMNProvider","children","contextValue","gmn","useConstant","Provider","value","useGMN","useContext","LoadDailyMeteorsDialog","useState","dailyInitialized","availablityInitialized","setAvailablityInitialized","useAsyncEffect","initDailyMeteorsAvailable","setDate","DailyMeteorsDatePicker","DatePicker","onChange","renderInput","params","TextField","inputFormat","shouldDisableDate","now","dailyMeteorsAvailable","Dialog","DialogTitle","DialogContent","Skeleton","DialogActions","Button","disabled","ShowerFilter","filterShowers","FormControl","width","InputLabel","id","Select","labelId","multiple","includes","input","OutlinedInput","renderValue","selected","event","MenuProps","Checkbox","checked","ListItemText","formatter","format","autoFocus","PaperProps","style","maxHeight","ITEM_HEIGHT","MagnitudeFilter","my","px","Slider","valueLabelDisplay","step","marks","valueUnless","unless","StationPrefixFilter","toUpperCase","rawPrefixes","filtered","prefix","station","startsWith","StationFilter","Filter","Toolbar","Typography","variant","Settings","FormControlLabel","control","Switch","radians","degrees","Math","PI","position","altitude","localUp","x","y","z","xyz","point","lat","long","cos","sin","MeteorTooltip","DEFAULT_COLOR","HIGHLIGHTED_COLOR","SELECTED_COLOR","ZERO_MATRIX","Matrix4","InstancedMeteors","data","selectMeteor","filteredMeteors","ref","useRef","old","useFrame","camera","current","warn","mesh","setMatrixAt","buildMeteorMatrix","color","hoverInstanceIdRef","setColorAt","instanceMatrix","needsUpdate","instanceColor","hover","setHover","invalidate","useThree","lastFilterMeteorsRef","args","instanceId","stopPropagation","onDoubleClick","onPointerOver","onPointerOut","vertexShader","fragmentShader","transparent","depthWrite","Html","calculatePosition","el","size","getIndex","parent","InstancedMesh","getMatrixAt","objectPos","v1","setFromMatrixPosition","project","widthHalf","heightHalf","calculateTooltipPosition","Vector3","cameraPosition","brightness","tail","head","tx","ty","tz","center","cx","cy","cz","vector","clone","normalize","view","sub","perp","cross","right","rotation","xAxis","yAxis","zAxis","makeBasis","quaternion","Quaternion","setFromRotationMatrix","scale","compose","CAMERA_CONFIG","fov","near","far","CameraControls","createRef","state","v","vector3EqualsXYZ","reset","updateProjectionMatrix","OrbitControls","zoomSpeed","rotateSpeed","Globe","setCameraControl","material","useTexture","textures","bumpMap","specularMap","chooseTextures","clouds","frameloop","intensity","visible","emissive","alphaMap","LuxonSettings","defaultZone","queryParams","URLSearchParams","window","location","search","Intl","NumberFormat","App","setError","useCallback","focusedMeteorCameraControl","useEffect","tryLoadMeteors","loadMeteors","test","meteorDataInfoFromParams","filterVisible","setFilterVisible","meteorVisibility","some","filterMeteors","settingsVisible","setSettingsVisible","subscribe","Header","numVisibleMeteors","menuVisible","setMenuVisible","menuAnchorEl","setMenuAnchorEl","loadDailyMeteorsDialogOpen","setLoadDailyMeteorsDialogOpen","AppBar","boxShadow","display","flexGrow","currentTarget","n","titleSuffix","dailyMeteorsInfo","LocalizationProvider","dateAdapter","DateAdapter","Snackbar","Alert","severity","flexFlow","flex","focus","bottom","Footer","Drawer","anchor","align","Date","getFullYear","Link","href","rel","ReactDOM","render","StrictMode","ThemeProvider","CssBaseline","Suspense","fallback","document","getElementById"],"mappings":"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","file":"static/js/main.9a189e91.chunk.js","sourcesContent":["import { createTheme } from \"@mui/material/styles\";\n\nconst theme = createTheme({\n  palette: {\n    mode: \"dark\",\n  },\n});\n\nexport default theme;\n","import { SettingsData } from \"./interfaces\";\n\nconst SETTINGS = \"settings\";\n\nconst DEFAULT_SETTINGS = {\n  showClouds: true,\n  light: true,\n  cityLights: false,\n};\n\nexport function saveSettings(settings: SettingsData) {\n  localStorage.setItem(SETTINGS, JSON.stringify(settings));\n}\n\nexport function loadSettings(): SettingsData {\n  try {\n    const s = localStorage.getItem(SETTINGS);\n    if (s) return JSON.parse(s);\n  } catch (e) {\n    console.error(\"[settings] load failed\", e);\n  }\n  return DEFAULT_SETTINGS;\n}\n","import { Color } from \"three\";\nimport { XYZ, Km, Magnitude, CameraControlData } from \"./interfaces\";\n\nexport const EARTH_RADIUS: Km = 6371.37;\n\nexport const MIN_MAGNITUDE: Magnitude = -10;\nexport const MAX_MAGNITUDE: Magnitude = 10;\n\nconst MIN_CAMERA_HEIGHT: Km = 200;\nconst MAX_CAMERA_HEIGHT: Km = 10000;\n\nexport const DEFAULT_UP: XYZ = [0, 1, 0];\n\nexport const DEFAULT_CAMERA_CONTROL: CameraControlData = {\n  target: [0, 0, 0],\n  up: DEFAULT_UP,\n  minDistance: EARTH_RADIUS + MIN_CAMERA_HEIGHT,\n  maxDistance: EARTH_RADIUS + MAX_CAMERA_HEIGHT,\n};\n\nexport const CLOUD_HEIGHT = 10;\n\nexport const CITY_LIGHTS_COLOR = new Color(0xffff80);\nexport const AMBIENT_LIGHT_INTENSITY = 0.075;\n","import { Store } from \"pullstate\";\nimport { enableMapSet } from \"immer\";\n\nimport { MarkerProps } from \"./3d/Marker\";\nimport { AppState, StationData, StationCode } from \"./interfaces\";\nimport { loadSettings } from \"./settings\";\nimport { DEFAULT_CAMERA_CONTROL } from \"./constants\";\n\nenableMapSet();\n\nexport const store = new Store<AppState>({\n  highlightedMarker: \"\",\n  markers: new Map<string, MarkerProps>([\n    [\n      \"UK003C\",\n      {\n        identifier: \"UK003C\",\n        latitude: 50.224871,\n        longitude: -4.949858,\n        label: \"UK003C\",\n      },\n    ],\n  ]),\n  loading: true,\n  meteorDataInfo: {\n    url: \"\",\n    title: \"\",\n  },\n  meteors: [],\n  selectedMeteor: undefined,\n  activeShowers: [],\n  stationsByCode: new Map<StationCode, StationData>(),\n  stations: [],\n  filter: {\n    showers: [],\n    magnitude: { min: undefined, max: undefined },\n    stations: {\n      codes: [],\n      prefixes: \"\",\n    },\n  },\n  cameraControl: DEFAULT_CAMERA_CONTROL,\n  settings: loadSettings(),\n});\n","import parse from \"csv-parse/lib/sync\";\nimport { Degrees } from \"../interfaces\";\nimport { store } from \"../store\";\n\nexport interface CameraData {\n  identifier: string;\n  latitude: Degrees;\n  longitude: Degrees;\n}\n\nexport async function loadCameras(url: string): Promise<CameraData[]> {\n  const response = await fetch(url);\n  if (response.ok) {\n    const csv = await response.text();\n    // console.info(\"cameras csv\", csv);\n\n    const records = parse(csv, { columns: true });\n    return records.map((r: any) => ({\n      identifier: r.camera_id,\n      latitude: r.obs_latitude,\n      longitude: r.obs_longitude,\n    }));\n  } else return Promise.reject(response.statusText);\n}\n\nexport function initCameras() {\n  loadCameras(\"/meteor-globe/data/cameradetails.csv\")\n    .then((cameras) => {\n      // console.info(\"[cameras]\", cameras);\n      store.update((s) => {\n        const m = s.markers;\n        for (const c of cameras) {\n          m.set(c.identifier, { ...c, label: c.identifier });\n        }\n      });\n    })\n    .catch((e) => {\n      console.error(\"[cameras] load failed\", e);\n    });\n}\n","import { MeteorData, ShowerData, ActiveShowerData } from \"../interfaces\";\n\nconst showers = require(\"./showers.json\");\nconst showersByCode = new Map<string, ShowerData>();\nfor (const s of showers) {\n  // console.info(s);\n  showersByCode.set(s.code, s);\n}\n\nconst SPORADIC_CODE = \"...\";\nconst SPORADIC = {\n  code: SPORADIC_CODE,\n  name: \"(sporadic)\",\n  numMeteors: 0,\n};\n\nexport function getShower(code: string): ShowerData {\n  if (code === SPORADIC_CODE) return SPORADIC;\n\n  const s = showersByCode.get(code);\n  if (s) return s;\n\n  // not in IAU list\n  const u = {\n    code,\n    name: \"(unknown)\",\n  };\n  showersByCode.set(code, u);\n  return u;\n}\n\nexport function isSporadic(shower: ShowerData) {\n  return shower.code === SPORADIC_CODE;\n}\n\nexport function buildActiveShowers(meteors: MeteorData[]): ActiveShowerData[] {\n  const map = new Map<ShowerData, ActiveShowerData>();\n\n  for (const meteor of meteors) {\n    const { shower } = meteor;\n    const activeShower = map.get(shower);\n    if (activeShower) {\n      activeShower.meteors.push(meteor);\n    } else {\n      map.set(shower, {\n        shower,\n        meteors: [meteor],\n      });\n    }\n  }\n\n  const activeShowers = [...map.values()];\n  activeShowers.sort((a, b) => b.meteors.length - a.meteors.length);\n  return activeShowers;\n}\n","import { StationCode, StationData, MeteorData } from \"../interfaces\";\n\nexport function initStations(\n  meteors: MeteorData[],\n  stationsByCode: Map<string, StationData>\n): StationData[] {\n  const activeStationCodes = new Set<StationCode>();\n  for (const m of meteors) {\n    for (const code of m.stationCodes) {\n      if (!stationsByCode.has(code)) {\n        stationsByCode.set(code, { code });\n      }\n      activeStationCodes.add(code);\n    }\n  }\n\n  const stations: StationData[] = [];\n  for (const c of activeStationCodes) {\n    stations.push(stationsByCode.get(c)!);\n  }\n  stations.sort((a, b) => a.code.localeCompare(b.code));\n  console.info(\"[stations]\", stations.length);\n  return stations;\n}\n","import fetchline from \"fetchline\";\n\nimport { store } from \"../store\";\nimport { MeteorDataInfo, MeteorData, FilterData } from \"../interfaces\";\nimport { getShower, buildActiveShowers } from \"./showers\";\nimport { initStations } from \"./stations\";\n\nexport const DEFAULT_COLOR = [1, 1, 1];\nexport const HIGHLIGHTED_COLOR = [1.0, 0.27, 0.71]; // CSS hotpink #FF69B4\n\nexport const METEORS_YESTERDAY = {\n  url: \"https://globalmeteornetwork.org/data/traj_summary_data/daily/traj_summary_yesterday.txt\",\n  title: \"Yesterday\",\n};\n\nexport const METEORS_LATEST_DAILY = {\n  url: \"https://globalmeteornetwork.org/data/traj_summary_data/daily/traj_summary_latest_daily.txt\",\n  title: \"Latest Daily\",\n};\n\nexport function meteorDataInfoFromParams(\n  params: URLSearchParams\n): MeteorDataInfo {\n  const test = params.get(\"test\");\n  if (test !== null) {\n    switch (test) {\n      case \"one_perseid\":\n        return {\n          url: \"/meteor-globe/data/one_perseid.txt\",\n          title: \"Test - One Perseid\",\n        };\n      default:\n        return {\n          url: \"/meteor-globe/data/traj_summary_20210812_solrange_140.0-141.0.txt\",\n          title: \"Test - Lots of Perseids\",\n        };\n    }\n  }\n\n  // default to all detected by GMN yesterday\n  return METEORS_YESTERDAY;\n}\n\nexport async function loadMeteors(info: MeteorDataInfo) {\n  console.info(\"[meteors] LOAD\", info.title, info.url);\n\n  store.update((s) => {\n    s.meteorDataInfo = info;\n    s.loading = true;\n    s.selectedMeteor = undefined;\n    s.meteors = [];\n    s.activeShowers = [];\n  });\n\n  try {\n    const meteors = await fetchMeteorData(info.url);\n    const activeShowers = buildActiveShowers(meteors);\n    store.update((s) => {\n      s.loading = false;\n      s.meteors = meteors;\n      s.activeShowers = activeShowers;\n      s.stations = initStations(meteors, s.stationsByCode);\n\n      s.filter.showers = activeShowers.map((a) => a.shower);\n      s.filter.stations.codes = s.stations.map((s) => s.code);\n    });\n  } finally {\n    store.update((s) => {\n      s.loading = false;\n    });\n  }\n}\n\n// column indices\nconst BEGIN_UTC_TIME = 1;\nconst IAU_CODE = 3;\nconst AVERAGE_SPEED = 58;\nconst BEGIN_LATITUDE = 60;\nconst BEGIN_LONGITUDE = 62;\nconst BEGIN_HEIGHT = 64;\nconst END_LATITUDE = 66;\nconst END_LONGITUDE = 68;\nconst END_HEIGHT = 70;\nconst DURATION = 72;\nconst MAGNITUDE = 73;\nconst PEAK_HEIGHT = 74;\nconst MASS = 76;\nconst STATION_CODES = 82;\n\nconst NUM_COLUMNS = 83;\n\nasync function fetchMeteorData(url: string): Promise<MeteorData[]> {\n  const meteors: MeteorData[] = [];\n  let nextIndex = 0;\n  for await (let line of fetchline(url)) {\n    if (line.length === 0) continue;\n    if (line[0] === \"\\r\") line = line.slice(1); // fetchline bug?\n    if (line[0] === \"#\") continue; // comment, probably column headers\n\n    const fields = line.split(\";\");\n    if (fields.length !== NUM_COLUMNS) continue;\n\n    const s = (i: number): string => {\n      const f = fields[i];\n      return f ? f.trim() : \"\";\n    };\n\n    const f = (i: number): number => {\n      return parseFloat(s(i));\n    };\n\n    const beginTime = s(BEGIN_UTC_TIME);\n    const showerCode = s(IAU_CODE);\n    const begin = {\n      latitude: f(BEGIN_LATITUDE),\n      longitude: f(BEGIN_LONGITUDE),\n      height: f(BEGIN_HEIGHT),\n    };\n    const end = {\n      latitude: f(END_LATITUDE),\n      longitude: f(END_LONGITUDE),\n      height: f(END_HEIGHT),\n    };\n    const averageSpeed = f(AVERAGE_SPEED);\n    const duration = f(DURATION);\n    const magnitude = f(MAGNITUDE);\n    const peakHeight = f(PEAK_HEIGHT);\n    const mass = f(MASS);\n    const stationCodes = s(STATION_CODES).split(\",\");\n\n    const shower = getShower(showerCode);\n    meteors.push({\n      index: nextIndex++,\n      beginTime,\n      shower,\n      begin,\n      end,\n      peakHeight,\n      magnitude,\n      duration,\n      mass,\n      averageSpeed,\n      stationCodes,\n    });\n  }\n\n  return meteors;\n}\n\nexport function filterMeteors(\n  filter: FilterData,\n  meteors: MeteorData[]\n): boolean[] {\n  return meteors.map((m) => {\n    const { shower, magnitude, stationCodes } = m;\n\n    // by shower\n    if (!filter.showers.includes(shower)) return false;\n\n    // by magnitude\n    const { min, max } = filter.magnitude;\n    if (min !== undefined && magnitude < min) return false;\n    if (max !== undefined && magnitude > max) return false;\n\n    // by station code\n    if (!stationCodes.some((c) => filter.stations.codes.includes(c)))\n      return false;\n\n    return true;\n  });\n}\n","import { Menu, MenuItem, Divider } from \"@mui/material\";\n\nimport { MeteorDataInfo } from \"../interfaces\";\nimport { METEORS_YESTERDAY, METEORS_LATEST_DAILY } from \"../data/meteors\";\n\ninterface Props {\n  anchorEl: HTMLElement | null;\n  open: boolean;\n  onClose: () => void;\n  onLoadMeteors: (info: MeteorDataInfo) => void;\n  showLoadDailyDialog: () => void;\n  resetView: () => void;\n}\n\nexport function AppMenu(props: Props) {\n  const {\n    anchorEl,\n    open,\n    onClose,\n    onLoadMeteors,\n    showLoadDailyDialog,\n    resetView,\n  } = props;\n\n  return (\n    <Menu open={open} onClose={onClose} anchorEl={anchorEl}>\n      <MenuItem\n        onClick={() => {\n          onLoadMeteors(METEORS_YESTERDAY);\n        }}\n      >\n        {METEORS_YESTERDAY.title}\n      </MenuItem>\n      <MenuItem\n        onClick={() => {\n          onLoadMeteors(METEORS_LATEST_DAILY);\n        }}\n      >\n        {METEORS_LATEST_DAILY.title}\n      </MenuItem>\n      <MenuItem onClick={showLoadDailyDialog}>Daily...</MenuItem>\n      <Divider />\n      <MenuItem onClick={resetView}>Reset view</MenuItem>\n    </Menu>\n  );\n}\n","import { Box, Stack, IconButton, Tooltip } from \"@mui/material\";\nimport CenterFocusStrongRoundedIcon from \"@mui/icons-material/CenterFocusStrongRounded\";\n\nimport { MeteorData } from \"../interfaces\";\nimport { isSporadic } from \"../data/showers\";\nimport \"./MeteorInfo.css\";\n\nexport interface MeteorInfoProps {\n  meteor: MeteorData;\n  focusMeteor: () => void;\n}\n\nexport function MeteorInfo(props: MeteorInfoProps) {\n  const { meteor, focusMeteor } = props;\n  const {\n    shower,\n    beginTime,\n    magnitude,\n    duration,\n    // averageSpeed,\n    stationCodes,\n  } = meteor;\n\n  return (\n    <Box className=\"root\">\n      <Stack\n        direction=\"row\"\n        sx={{ justifyContent: \"space-between\", alignItems: \"center\" }}\n      >\n        <div>\n          {!isSporadic(shower) && (\n            <span className=\"showerCode\">\n              {shower.code}\n              {\" — \"}\n            </span>\n          )}\n          <span className=\"showerName\">{shower.name}</span>\n        </div>\n        <Tooltip title=\"Focus view on this meteor\">\n          <IconButton\n            onClick={() => {\n              focusMeteor();\n            }}\n          >\n            <CenterFocusStrongRoundedIcon />\n          </IconButton>\n        </Tooltip>\n      </Stack>\n      <div className=\"beginTime\">{beginTime}</div>\n      <div className=\"magnitude\">Mag {magnitude}</div>\n      <div className=\"duration\">{duration}s</div>\n      {/*<div className=\"averageSpeed\">{averageSpeed}kms⁻¹</div>*/}\n      <div className=\"stationCodes\">{stationCodes.join(\", \")}</div>\n    </Box>\n  );\n}\n","import { DateTime } from \"luxon\";\n// import { base, julian, solar } from \"astronomia\";\nimport { MeteorDataInfo } from \"../interfaces\";\n\nconst URL_BASE = \"https://globalmeteornetwork.org/data/traj_summary_data/\";\n\n// const GMN_EARLIEST_DATE = DateTime.fromISO(\"2020-09-18\").toJSDate();\n\nconst DAILY_URL_REGEX =\n  /<a href=\"(?<filename>traj_summary_(?<date>\\d{8})_solrange_(?<solarLongitudeFrom>\\d{3}.\\d)-(?<solarLongitudeTo>\\d{3}.\\d).txt)\">/g;\n\nexport class GMN {\n  url(filename: string) {\n    return URL_BASE + filename;\n  }\n\n  dailyMeteorsUrl(date: DateTime) {\n    // const jde = julian.DateToJDE(date.toJSDate());\n    // const c = base.J2000Century(jde);\n    // const { lon } = solar.true2000(c);\n    // const l = Math.ceil((180 * lon) / Math.PI);\n    // const d = date.toFormat(\"yyyyMMdd\");\n    // const f = `daily/traj_summary_${d}_solrange_${l}.0-${l + 1}.0.txt`;\n    // console.info(date, jde, c, lon);\n    // console.info(d, l, f);\n\n    const d = date.toFormat(\"yyyyMMdd\");\n    const f = this._dailyFileNamesByDate.get(d);\n    if (f) return this.url(`daily/${f}`);\n    throw Error(`No daily data available for ${date}`);\n  }\n\n  dailyMeteorsInfo(date: DateTime): MeteorDataInfo {\n    return {\n      title: \"Daily \" + date.toLocaleString(DateTime.DATE_FULL),\n      url: this.dailyMeteorsUrl(date),\n    };\n  }\n\n  private _dailyFileNamesByDate = new Map<string, string>();\n  private _dailyInitialized = false;\n\n  get dailyInitialized() {\n    return this._dailyInitialized;\n  }\n\n  async initDailyMeteorsAvailable() {\n    if (!this._dailyInitialized) {\n      try {\n        const r = await fetch(URL_BASE + \"daily/\");\n        if (r.ok) {\n          const s = await r.text();\n          const ms = s.matchAll(DAILY_URL_REGEX);\n          for (const m of ms) {\n            if (m.groups) {\n              const date = m.groups[\"date\"];\n              const filename = m.groups[\"filename\"];\n              console.info(date, filename);\n              this._dailyFileNamesByDate.set(date, filename);\n            }\n          }\n        }\n      } catch (e) {\n        console.error(e);\n      } finally {\n        this._dailyInitialized = true;\n      }\n    }\n  }\n\n  dailyMeteorsAvailable(date: DateTime): boolean {\n    const d = date.toFormat(\"yyyyMMdd\");\n    return this._dailyFileNamesByDate.has(d);\n  }\n}\n","import { createContext, useContext } from \"react\";\nimport useConstant from \"use-constant\";\n\nimport { GMN } from \"./data/GMN\";\n\nexport interface GMNContext {\n  gmn: GMN;\n}\n\nconst Context = createContext<GMNContext | null>(null);\n\nexport function GMNProvider({ children }) {\n  const gmn = useConstant(() => new GMN());\n\n  const contextValue = { gmn };\n\n  return <Context.Provider value={contextValue}>{children}</Context.Provider>;\n}\n\nexport function useGMN(): GMNContext {\n  const c = useContext(Context);\n  if (c) return c;\n  throw Error(\"useGMN used outside GMNProvider\");\n}\n","import { useState } from \"react\";\nimport {\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  Button,\n  TextField,\n  Skeleton,\n} from \"@mui/material\";\nimport { DatePicker } from \"@mui/lab\";\nimport { DateTime } from \"luxon\";\nimport useAsyncEffect from \"use-async-effect\";\n\nimport { useGMN } from \"../GMNProvider\";\n\ninterface Props {\n  open: boolean;\n  onClose: () => void;\n  onLoadMeteors: (date: DateTime) => void;\n}\n\nexport function LoadDailyMeteorsDialog(props: Props) {\n  const { open, onClose, onLoadMeteors } = props;\n\n  const { gmn } = useGMN();\n  const [availablityInitialized, setAvailablityInitialized] = useState(\n    gmn.dailyInitialized\n  );\n  useAsyncEffect(async () => {\n    if (open && !availablityInitialized) {\n      await gmn.initDailyMeteorsAvailable();\n      setAvailablityInitialized(true);\n    }\n  });\n\n  const [date, setDate] = useState<DateTime | null>(null);\n  // const today = DateTime.now();\n\n  const DailyMeteorsDatePicker = () => {\n    return (\n      <DatePicker\n        label=\"dd/mm/yyyy\"\n        value={date}\n        onChange={setDate}\n        renderInput={(params) => <TextField {...params} />}\n        inputFormat=\"dd/MM/yyyy\"\n        shouldDisableDate={(date) =>\n          date > DateTime.now() || !gmn.dailyMeteorsAvailable(date)\n        }\n      />\n    );\n  };\n\n  return (\n    <Dialog open={open} onClose={onClose}>\n      <DialogTitle>Load Daily Meteors</DialogTitle>\n      <DialogContent>\n        {!availablityInitialized && (\n          <Skeleton>\n            <DailyMeteorsDatePicker />\n          </Skeleton>\n        )}\n        {availablityInitialized && <DailyMeteorsDatePicker />}\n      </DialogContent>\n      <DialogActions>\n        <Button\n          disabled={date === null}\n          onClick={() => {\n            console.info(date);\n            if (date) onLoadMeteors(date);\n          }}\n        >\n          Load\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n","import {\n  FormControl,\n  Stack,\n  Button,\n  InputLabel,\n  Select,\n  SelectChangeEvent,\n  OutlinedInput,\n  MenuItem,\n  Checkbox,\n  ListItemText,\n} from \"@mui/material\";\n\nimport { ActiveShowerData } from \"../../interfaces\";\nimport { store } from \"../../store\";\nimport { formatter } from \"../../App\";\n\nexport function ShowerFilter() {\n  const activeShowers = store.useState((s) => s.activeShowers);\n  const filterShowers = store.useState((s) => s.filter.showers);\n\n  return (\n    <>\n      <FormControl sx={{ m: 1, width: 280 }}>\n        <InputLabel id=\"showers-label\">Showers</InputLabel>\n        <Select\n          labelId=\"showers-label\"\n          multiple\n          value={activeShowers.filter((s) => filterShowers.includes(s.shower))}\n          input={<OutlinedInput label=\"Showers\" />}\n          renderValue={(selected) => {\n            if (selected.length === 0) return \"(none)\";\n            const ss = [...selected];\n            const names = ss.map((s) => s.shower.name);\n            return names.join(\", \");\n          }}\n          onChange={(event: SelectChangeEvent<ActiveShowerData[]>) => {\n            const { value } = event.target;\n            if (typeof value === \"string\") return;\n            store.update((s) => {\n              s.filter.showers = value.map((s) => s.shower);\n            });\n          }}\n          MenuProps={MenuProps}\n        >\n          {activeShowers.map((s) => (\n            <MenuItem key={s.shower.code} value={s as any}>\n              <Checkbox checked={filterShowers.includes(s.shower)} />\n              <ListItemText>\n                {s.shower.name}\n                {\" (\"}\n                {formatter.format(s.meteors.length)}\n                {\")\"}\n              </ListItemText>\n            </MenuItem>\n          ))}\n        </Select>\n      </FormControl>\n      <Stack direction=\"row\">\n        <Button\n          onClick={() => {\n            store.update((s) => {\n              s.filter.showers = activeShowers.map((s) => s.shower);\n            });\n          }}\n        >\n          all\n        </Button>\n        <Button\n          onClick={() => {\n            store.update((s) => {\n              s.filter.showers = [];\n            });\n          }}\n        >\n          none\n        </Button>\n      </Stack>\n    </>\n  );\n}\n\nconst ITEM_HEIGHT = 54;\nconst ITEM_PADDING_TOP = 8;\nconst MenuProps = {\n  autoFocus: false, // kludge to stop initial scoll to end\n  PaperProps: {\n    style: {\n      maxHeight: ITEM_HEIGHT * 6.5 + ITEM_PADDING_TOP,\n      width: 280,\n    },\n  },\n};\n","import { Box, Slider } from \"@mui/material\";\n\nimport { Magnitude } from \"../../interfaces\";\nimport { MIN_MAGNITUDE, MAX_MAGNITUDE } from \"../../constants\";\nimport { store } from \"../../store\";\n\nexport function MagnitudeFilter() {\n  const { min = MIN_MAGNITUDE, max = MAX_MAGNITUDE } = store.useState(\n    (s) => s.filter.magnitude\n  );\n\n  return (\n    <Box sx={{ my: \"16px\", px: \"24px\" }}>\n      <Slider\n        min={MIN_MAGNITUDE}\n        max={MAX_MAGNITUDE}\n        value={[min, max]}\n        valueLabelDisplay=\"auto\"\n        step={0.1}\n        marks={[\n          {\n            value: MIN_MAGNITUDE,\n            label: `< ${MIN_MAGNITUDE}`,\n          },\n          {\n            value: 0,\n            label: \"Magnitude\",\n          },\n          {\n            value: MAX_MAGNITUDE,\n            label: `> ${MAX_MAGNITUDE}`,\n          },\n        ]}\n        onChange={(event, value, index) => {\n          store.update((s) => {\n            if (typeof value === \"number\") {\n              if (index === 0)\n                s.filter.magnitude.min = valueUnless(MIN_MAGNITUDE, value);\n              else s.filter.magnitude.max = valueUnless(MAX_MAGNITUDE, value);\n            } else {\n              s.filter.magnitude.min = valueUnless(MIN_MAGNITUDE, value[0]);\n              s.filter.magnitude.max = valueUnless(MAX_MAGNITUDE, value[1]);\n            }\n          });\n        }}\n      />\n    </Box>\n  );\n}\n\nfunction valueUnless(\n  unless: Magnitude,\n  value: Magnitude\n): Magnitude | undefined {\n  return value === unless ? undefined : value;\n}\n","import { FormControl, TextField } from \"@mui/material\";\n\nimport { StationData, StationCode } from \"../../interfaces\";\nimport { store } from \"../../store\";\n\nexport function StationPrefixFilter() {\n  const stations = store.useState((s) => s.stations);\n  const prefixes = store.useState((s) => s.filter.stations.prefixes);\n\n  return (\n    <FormControl sx={{ m: 1, width: 280 }}>\n      <TextField\n        label=\"Station prefixes\"\n        value={prefixes}\n        onChange={(event) => {\n          const prefixes = event.target.value.toUpperCase();\n          store.update((s) => {\n            s.filter.stations = { prefixes, codes: filter(stations, prefixes) };\n          });\n        }}\n      />\n    </FormControl>\n  );\n}\n\nfunction filter(stations: StationData[], rawPrefixes: string): StationCode[] {\n  rawPrefixes = rawPrefixes.trim();\n  if (rawPrefixes === \"\") return stations.map((s) => s.code);\n\n  const prefixes = rawPrefixes.split(/[^a-zA-Z0-9]+/);\n\n  const filtered = new Set<StationCode>();\n  for (const prefix of prefixes) {\n    for (const station of stations) {\n      if (station.code.startsWith(prefix)) filtered.add(station.code);\n    }\n  }\n\n  return [...filtered];\n}\n","import {\n  FormControl,\n  Stack,\n  Button,\n  InputLabel,\n  Select,\n  SelectChangeEvent,\n  OutlinedInput,\n  MenuItem,\n  Checkbox,\n  ListItemText,\n} from \"@mui/material\";\n\nimport { StationData } from \"../../interfaces\";\nimport { store } from \"../../store\";\n\nexport function StationFilter() {\n  const stations = store.useState((s) => s.stations);\n  const codes = store.useState((s) => s.filter.stations.codes);\n\n  return (\n    <>\n      <FormControl sx={{ m: 1, width: 280 }}>\n        <InputLabel id=\"stations-label\">Stations</InputLabel>\n        <Select\n          labelId=\"stations-label\"\n          multiple\n          value={stations.filter((s) => codes.includes(s.code))}\n          input={<OutlinedInput label=\"Stations\" />}\n          renderValue={(selected) => {\n            if (selected.length === stations.length) return \"(all)\";\n            if (selected.length === 0) return \"(none)\";\n            const ss = [...selected];\n            const codes = ss.map((s) => s.code);\n            return codes.join(\", \");\n          }}\n          onChange={(event: SelectChangeEvent<StationData[]>) => {\n            const { value } = event.target;\n            if (typeof value === \"string\") return;\n            store.update((s) => {\n              s.filter.stations = {\n                codes: value.map((s) => s.code),\n                prefixes: \"\",\n              };\n            });\n          }}\n          MenuProps={MenuProps}\n        >\n          {stations.map((s) => (\n            <MenuItem key={s.code} value={s as any}>\n              <Checkbox checked={codes.includes(s.code)} />\n              <ListItemText>{s.code}</ListItemText>\n            </MenuItem>\n          ))}\n        </Select>\n      </FormControl>\n      <Stack direction=\"row\">\n        <Button\n          onClick={() => {\n            store.update((s) => {\n              s.filter.stations = {\n                codes: stations.map((s) => s.code),\n                prefixes: \"\",\n              };\n            });\n          }}\n        >\n          all\n        </Button>\n        <Button\n          onClick={() => {\n            store.update((s) => {\n              s.filter.stations = {\n                codes: [],\n                prefixes: \"\",\n              };\n            });\n          }}\n        >\n          none\n        </Button>\n      </Stack>\n    </>\n  );\n}\n\nconst ITEM_HEIGHT = 54;\nconst ITEM_PADDING_TOP = 8;\nconst MenuProps = {\n  autoFocus: false, // kludge to stop initial scoll to end\n  PaperProps: {\n    style: {\n      maxHeight: ITEM_HEIGHT * 6.5 + ITEM_PADDING_TOP,\n      width: 280,\n    },\n  },\n};\n","import { Box, Typography, Toolbar, IconButton } from \"@mui/material\";\nimport ChevronRightRoundedIcon from \"@mui/icons-material/ChevronRightRounded\";\n\nimport { ShowerFilter } from \"./filter/ShowerFilter\";\nimport { MagnitudeFilter } from \"./filter/MagnitudeFilter\";\nimport { StationPrefixFilter } from \"./filter/StationPrefixFilter\";\nimport { StationFilter } from \"./filter/StationFilter\";\n\ninterface Props {\n  onClose: () => void;\n}\n\nexport function Filter(props: Props) {\n  const { onClose } = props;\n\n  return (\n    <Box sx={{ width: 300 }}>\n      <Toolbar sx={{ justifyContent: \"space-between\" }}>\n        <Typography variant=\"h6\">Filter</Typography>\n        <IconButton onClick={onClose}>\n          <ChevronRightRoundedIcon />\n        </IconButton>\n      </Toolbar>\n      <ShowerFilter />\n      <MagnitudeFilter />\n      <StationPrefixFilter />\n      <StationFilter />\n    </Box>\n  );\n}\n","import {\n  Box,\n  Stack,\n  Typography,\n  Toolbar,\n  IconButton,\n  FormControlLabel,\n  Switch,\n} from \"@mui/material\";\nimport ChevronRightRoundedIcon from \"@mui/icons-material/ChevronRightRounded\";\n\nimport { store } from \"../store\";\n\ninterface Props {\n  onClose: () => void;\n}\n\nexport function Settings(props: Props) {\n  const { onClose } = props;\n\n  const { showClouds, light, cityLights } = store.useState((s) => s.settings);\n\n  return (\n    <Box sx={{ width: 300 }}>\n      <Toolbar sx={{ justifyContent: \"space-between\" }}>\n        <Typography variant=\"h6\">Settings</Typography>\n        <IconButton onClick={onClose}>\n          <ChevronRightRoundedIcon />\n        </IconButton>\n      </Toolbar>\n\n      <Stack direction=\"column\" sx={{ px: 2 }}>\n        <FormControlLabel\n          control={\n            <Switch\n              checked={showClouds}\n              onChange={(event) => {\n                store.update((s) => {\n                  s.settings.showClouds = event.target.checked;\n                });\n              }}\n            />\n          }\n          label=\"Clouds\"\n        />\n        <FormControlLabel\n          control={\n            <Switch\n              checked={light}\n              onChange={(event) => {\n                store.update((s) => {\n                  s.settings.light = event.target.checked;\n                });\n              }}\n            />\n          }\n          label=\"Light\"\n        />\n        <FormControlLabel\n          control={\n            <Switch\n              checked={cityLights}\n              onChange={(event) => {\n                store.update((s) => {\n                  s.settings.cityLights = event.target.checked;\n                });\n              }}\n            />\n          }\n          label=\"City lights\"\n        />\n      </Stack>\n    </Box>\n  );\n}\n","import { Vector3 } from \"three\";\nimport { Degrees, Radians, Km, XYZ, LatLongHt } from \"../interfaces\";\nimport { EARTH_RADIUS } from \"../constants\";\n\nexport function radians(degrees: Degrees): Radians {\n  return (Math.PI * degrees) / 180;\n}\n\nexport function position(\n  latitude: Degrees,\n  longitude: Degrees,\n  altitude: Km\n): XYZ {\n  const [x, y, z] = localUp(latitude, longitude);\n  const r = altitude + EARTH_RADIUS;\n  return [r * x, r * y, r * z];\n}\n\nexport function xyz(point: LatLongHt): XYZ {\n  const { latitude, longitude, height } = point;\n  const lat = radians(latitude);\n  const long = radians(longitude);\n  const r = EARTH_RADIUS + height;\n  const x = r * Math.cos(lat) * Math.cos(-long);\n  const y = r * Math.sin(lat);\n  const z = r * Math.cos(lat) * Math.sin(-long);\n  return [x, y, z];\n}\n\nexport function localUp(latitude: Degrees, longitude: Degrees): XYZ {\n  const lat = radians(latitude);\n  const long = radians(longitude);\n  const x = Math.cos(lat) * Math.cos(-long);\n  const y = Math.sin(lat);\n  const z = Math.cos(lat) * Math.sin(-long);\n  return [x, y, z];\n}\n\nexport function vector3EqualsXYZ(v: Vector3, xyz: XYZ): boolean {\n  const [x, y, z] = xyz;\n  return v.x === x && v.y === y && v.z === z;\n}\n","import { MeteorData } from \"../interfaces\";\nimport \"./MeteorTooltip.css\";\n\nexport interface MeteorTooltipProps {\n  meteor: MeteorData;\n}\n\nexport function MeteorTooltip(props: MeteorTooltipProps) {\n  const { meteor } = props;\n  const { shower, beginTime, magnitude, duration, stationCodes } = meteor;\n\n  return (\n    <div className=\"meteorTooltip\">\n      <div className=\"showerCode\">{shower.code}</div>\n      <div className=\"beginTime\">{beginTime}</div>\n      <div className=\"magnitude\">Mag {magnitude}</div>\n      <div className=\"duration\">{duration}s</div>\n\n      <div className=\"stationCodes\">{stationCodes.join(\", \")}</div>\n    </div>\n  );\n}\n","import { useRef, useState } from \"react\";\nimport {\n  Matrix4,\n  Vector3,\n  Quaternion,\n  InstancedMesh,\n  Color,\n  Object3D,\n  Camera,\n} from \"three\";\nimport { useFrame, useThree } from \"@react-three/fiber\";\nimport { Html } from \"@react-three/drei\";\n\nimport { MeteorData, XYZ } from \"../interfaces\";\nimport { MeteorTooltip } from \"../ui/MeteorTooltip\";\nimport { xyz } from \"./geometry\";\n\nconst MIN_WIDTH = 0.1;\nconst MAG_ZERO_WIDTH = 2;\n\nconst DEFAULT_COLOR = new Color(\"white\");\nconst HIGHLIGHTED_COLOR = new Color(\"goldenrod\");\nconst SELECTED_COLOR = new Color(\"hotpink\");\n\n// workaround for R3F bug - pointer events stop working if instanced mesh is reinstantiated\nconst MAX_METEORS = 10000;\n\nconst ZERO_MATRIX = new Matrix4();\n\nexport interface InstancedMeteorsProps {\n  data: MeteorData[];\n  selectedMeteor?: MeteorData;\n  selectMeteor: (meteor: MeteorData, focus: boolean) => void;\n  filteredMeteors: boolean[];\n}\n\nexport function InstancedMeteors(props: InstancedMeteorsProps) {\n  const { data, selectedMeteor, selectMeteor, filteredMeteors } = props;\n\n  const vertexShader = `\n    varying vec2 vUv;\n    varying vec3 vColor;\n\n    void main() {\n      vUv = uv;\n      vColor = instanceColor;\n      gl_Position = projectionMatrix * modelViewMatrix * instanceMatrix * vec4(position,1.0);\n    }\n  `;\n\n  const fragmentShader = `\n    varying vec2 vUv;\n    varying vec3 vColor;\n\n    void main() {\n      float x = vUv.x;\n      float y = vUv.y;\n      float c = (x < 0.5 ? x : (1.0 - x)) * 2.0;\n      float p = 0.75;\n      float l = y < p ? (y / p) : (1.0 - y) / (1.0 - p);\n      float opacity = c * l;\n      gl_FragColor = vec4(vColor, opacity);\n    }\n  `;\n\n  const ref = useRef<InstancedMesh>();\n  const old = useRef<InstancedMesh>();\n\n  useFrame(({ camera }) => {\n    if (old.current !== ref.current) {\n      console.warn(\"new InstancedMesh\", ref.current);\n      old.current = ref.current;\n    }\n\n    // console.info(\"frame!\", data.length);\n    const mesh = ref.current;\n    if (mesh) {\n      for (const meteor of data) {\n        const i = meteor.index;\n        mesh.setMatrixAt(\n          i,\n          filteredMeteors[i]\n            ? buildMeteorMatrix(meteor, camera.position)\n            : ZERO_MATRIX\n        );\n        let color = DEFAULT_COLOR;\n        if (selectedMeteor && i === selectedMeteor.index)\n          color = SELECTED_COLOR;\n        else if (i === hoverInstanceIdRef.current) color = HIGHLIGHTED_COLOR;\n        mesh.setColorAt(i, color);\n      }\n\n      for (let i = data.length; i < MAX_METEORS; ++i) {\n        mesh.setMatrixAt(i, ZERO_MATRIX);\n      }\n\n      mesh.instanceMatrix.needsUpdate = true;\n      if (mesh.instanceColor) mesh.instanceColor.needsUpdate = true;\n    }\n  });\n\n  const [hover, setHover] = useState<MeteorData | undefined>(undefined);\n  const hoverInstanceIdRef = useRef<number | undefined>();\n\n  const { invalidate } = useThree();\n\n  const lastFilterMeteorsRef = useRef<boolean[]>([]);\n  if (filteredMeteors !== lastFilterMeteorsRef.current) {\n    lastFilterMeteorsRef.current = filteredMeteors;\n    invalidate();\n  }\n\n  return (\n    <>\n      {data.length && (\n        <instancedMesh\n          ref={ref}\n          args={[undefined, undefined, MAX_METEORS /*data.length*/]}\n          onClick={(e) => {\n            const i = e.instanceId;\n            if (i !== undefined) {\n              selectMeteor(data[i], false);\n              invalidate();\n            }\n            e.stopPropagation();\n          }}\n          onDoubleClick={(e) => {\n            const i = e.instanceId;\n            if (i !== undefined) {\n              selectMeteor(data[i], true);\n              invalidate();\n            }\n            e.stopPropagation();\n          }}\n          onPointerOver={(e) => {\n            // console.info(\"onPointerOver\", e.instanceId);\n            const i = e.instanceId;\n            if (i !== undefined) {\n              setHover(data[i]);\n              if (hoverInstanceIdRef.current !== i) {\n                hoverInstanceIdRef.current = i;\n              }\n            }\n          }}\n          onPointerOut={(e) => {\n            setHover(undefined);\n            if (hoverInstanceIdRef.current === e.instanceId) {\n              hoverInstanceIdRef.current = undefined;\n            }\n          }}\n        >\n          <planeGeometry args={[1, 1]} />\n          <shaderMaterial\n            vertexShader={vertexShader}\n            fragmentShader={fragmentShader}\n            transparent={true}\n            depthWrite={false}\n          />\n\n          {hover && (\n            <Html\n              calculatePosition={(el, camera, size) =>\n                calculateTooltipPosition(\n                  el,\n                  camera,\n                  size,\n                  () => hoverInstanceIdRef.current\n                )\n              }\n            >\n              <MeteorTooltip meteor={hover} />\n            </Html>\n          )}\n        </instancedMesh>\n      )}\n    </>\n  );\n}\n\nconst v1 = new Vector3();\nconst m = new Matrix4();\nfunction calculateTooltipPosition(\n  el: Object3D,\n  camera: Camera,\n  size: { width: number; height: number },\n  getIndex: () => number | undefined\n) {\n  const index = getIndex();\n\n  if (el.parent instanceof InstancedMesh && index !== undefined) {\n    el.parent.getMatrixAt(index, m);\n  } else {\n    // hide tooltip offscreen\n    return [-9999999, -9999999];\n  }\n  const objectPos = v1.setFromMatrixPosition(m);\n  objectPos.project(camera);\n  const widthHalf = size.width / 2;\n  const heightHalf = size.height / 2;\n  return [\n    objectPos.x * widthHalf + widthHalf,\n    -(objectPos.y * heightHalf) + heightHalf,\n  ];\n}\n\nfunction buildMeteorMatrix(\n  meteor: MeteorData,\n  cameraPosition: Vector3\n): Matrix4 {\n  const { begin, end, magnitude } = meteor;\n\n  const brightness = 1 - magnitude * 0.2;\n\n  const tail = xyz(begin);\n  const head = xyz(end);\n\n  const [tx, ty, tz] = tail;\n  const [hx, hy, hz] = head;\n\n  const center: XYZ = [(tx + hx) / 2, (ty + hy) / 2, (tz + hz) / 2];\n  const [cx, cy, cz] = center;\n  const position = new Vector3(cx, cy, cz);\n\n  const vector = new Vector3(\n    head[0] - tail[0],\n    head[1] - tail[1],\n    head[2] - tail[2]\n  );\n  const length = vector.length();\n  const width = Math.max(MIN_WIDTH, MAG_ZERO_WIDTH * brightness);\n  const direction = vector.clone();\n  direction.normalize();\n\n  // build matrix\n\n  const view = position.clone().sub(cameraPosition).normalize();\n  const perp = direction.clone().cross(view).normalize();\n  const up = direction.clone().cross(perp).normalize();\n  const right = direction.clone().cross(up);\n\n  const rotation = new Matrix4();\n  const xAxis = right;\n  const yAxis = direction;\n  const zAxis = up;\n  rotation.makeBasis(xAxis, yAxis, zAxis);\n\n  const quaternion = new Quaternion();\n  quaternion.setFromRotationMatrix(rotation);\n\n  const scale = new Vector3(width, length, 1);\n\n  const m = new Matrix4();\n  m.compose(position, quaternion, scale);\n  return m;\n}\n","import { createRef } from \"react\";\nimport { useThree, useFrame } from \"@react-three/fiber\";\nimport { OrbitControls } from \"@react-three/drei\";\nimport { OrbitControls as OrbitControlsImpl } from \"three-stdlib\";\n\nimport { CameraControlData } from \"../interfaces\";\nimport { DEFAULT_UP } from \"../constants\";\nimport { position, vector3EqualsXYZ } from \"./geometry\";\n\nexport const CAMERA_CONFIG = {\n  fov: 75,\n  near: 10,\n  far: 100000,\n  position: position(50.22, -4.95, 1500),\n};\n\nexport interface CameraControlsProps extends CameraControlData {}\n\nexport function CameraControls(props: CameraControlsProps) {\n  const { up } = props;\n\n  // console.info(\"[CameraControls]\", up);\n\n  const ref = createRef<OrbitControlsImpl>();\n\n  const state = useThree();\n  useFrame(() => {\n    const [x, y, z] = up;\n    const { camera } = state;\n    if (!vector3EqualsXYZ(camera.up, up)) {\n      if (up === DEFAULT_UP && ref.current) {\n        ref.current.reset();\n      }\n\n      camera.up.set(x, y, z);\n      camera.updateProjectionMatrix();\n    }\n  });\n\n  return (\n    <OrbitControls ref={ref} {...props} zoomSpeed={0.1} rotateSpeed={0.1} />\n  );\n}\n","import { Canvas } from \"@react-three/fiber\";\nimport { useTexture } from \"@react-three/drei\";\n\nimport { MeteorData, SettingsData, CameraControlData } from \"../interfaces\";\nimport {\n  EARTH_RADIUS,\n  DEFAULT_CAMERA_CONTROL,\n  CLOUD_HEIGHT,\n  CITY_LIGHTS_COLOR,\n  AMBIENT_LIGHT_INTENSITY,\n} from \"../constants\";\n\nimport { position } from \"./geometry\";\n\nimport { /*Marker, */ MarkerProps } from \"./Marker\";\nimport { InstancedMeteors } from \"./InstancedMeteors\";\nimport { CameraControls, CAMERA_CONFIG } from \"./CameraControls\";\n\nimport \"./Globe.css\";\n\nexport interface GlobeProps {\n  markers: MarkerProps[];\n  meteors: MeteorData[];\n  selectedMeteor?: MeteorData;\n  selectMeteor: (meteor: MeteorData, focus: boolean) => void;\n  filteredMeteors: boolean[];\n  settings: SettingsData;\n  cameraControl: CameraControlData;\n  setCameraControl: (cameraControl: CameraControlData) => void;\n}\n\nexport function Globe(props: GlobeProps) {\n  const {\n    /*markers,*/ meteors,\n    selectedMeteor,\n    selectMeteor,\n    filteredMeteors,\n    settings,\n    cameraControl,\n    setCameraControl,\n  } = props;\n\n  const material = useTexture(chooseTextures(settings));\n  const clouds = useTexture({\n    map: \"/meteor-globe/textures/fair_clouds_4k.jpeg\",\n  });\n  return (\n    <Canvas className=\"globeCanvas\" frameloop=\"demand\" camera={CAMERA_CONFIG}>\n      <CameraControls {...cameraControl} />\n      <ambientLight\n        intensity={AMBIENT_LIGHT_INTENSITY}\n        visible={settings.light}\n      />\n      <directionalLight\n        color=\"white\"\n        position={position(0, 0, 1)}\n        visible={settings.light}\n      />\n      <mesh\n        onDoubleClick={() => {\n          setCameraControl(DEFAULT_CAMERA_CONTROL);\n        }}\n      >\n        <sphereGeometry args={[EARTH_RADIUS, 128, 128]} />\n        <meshPhongMaterial\n          {...material}\n          emissive={\n            settings.light || !settings.cityLights\n              ? undefined\n              : CITY_LIGHTS_COLOR\n          }\n        />\n      </mesh>\n      <mesh visible={settings.showClouds}>\n        <sphereGeometry args={[EARTH_RADIUS + CLOUD_HEIGHT, 128, 128]} />\n        <meshBasicMaterial color={0xffffff} alphaMap={clouds.map} transparent />\n      </mesh>\n      {/*      {markers.map((m) => (\n        <Marker key={`marker-${m.identifier}`} {...m} />\n      ))}\n*/}\n      <InstancedMeteors\n        data={meteors}\n        selectedMeteor={selectedMeteor}\n        selectMeteor={selectMeteor}\n        filteredMeteors={filteredMeteors}\n      />\n    </Canvas>\n  );\n}\n\nfunction chooseTextures(settings: SettingsData): {\n  [k: string]: string;\n} {\n  const { light, cityLights } = settings;\n  const textures: any = {\n    map: \"/meteor-globe/textures/2_no_clouds_4k.jpeg\",\n    bumpMap: \"/meteor-globe/textures/elev_bump_4k.jpeg\",\n    specularMap: \"/meteor-globe/textures/water_4k.png\",\n  };\n\n  if (!light && cityLights)\n    textures[\"emissiveMap\"] = \"/meteor-globe/textures/5_night_4k.jpeg\";\n\n  return textures;\n}\n","import { useEffect, useState, useCallback } from \"react\";\n\nimport {\n  AppBar,\n  Toolbar,\n  Typography,\n  Box,\n  Link,\n  IconButton,\n  Alert,\n  Snackbar,\n  Drawer,\n  Tooltip,\n} from \"@mui/material\";\n\nimport MenuRoundedIcon from \"@mui/icons-material/MenuRounded\";\nimport SearchRoundedIcon from \"@mui/icons-material/SearchRounded\";\nimport SettingsRoundedIcon from \"@mui/icons-material/SettingsRounded\";\n\nimport { LocalizationProvider } from \"@mui/lab\";\nimport DateAdapter from \"@mui/lab/AdapterLuxon\";\n\nimport Div100vh from \"react-div-100vh\";\nimport { Settings as LuxonSettings } from \"luxon\";\n\nimport { initCameras } from \"./data/cameras\";\nimport {\n  meteorDataInfoFromParams,\n  loadMeteors,\n  filterMeteors,\n} from \"./data/meteors\";\n\nimport { AppMenu } from \"./ui/AppMenu\";\nimport { MeteorInfo } from \"./ui/MeteorInfo\";\nimport { LoadDailyMeteorsDialog } from \"./ui/LoadDailyMeteorsDialog\";\nimport { Filter } from \"./ui/Filter\";\nimport { Settings } from \"./ui/Settings\";\n\nimport { Globe } from \"./3d/Globe\";\nimport { xyz, localUp } from \"./3d/geometry\";\n\nimport { MeteorDataInfo, MeteorData, CameraControlData } from \"./interfaces\";\nimport { store } from \"./store\";\nimport { useGMN } from \"./GMNProvider\";\nimport { saveSettings } from \"./settings\";\nimport { DEFAULT_CAMERA_CONTROL } from \"./constants\";\n\nimport \"./App.css\";\n\nLuxonSettings.defaultZone = \"Europe/London\";\n\nconst queryParams = new URLSearchParams(window.location.search);\nexport const formatter = new Intl.NumberFormat();\n\nexport default function App() {\n  const [error, setError] = useState<string | undefined>();\n\n  const cameraControl = store.useState((s) => s.cameraControl);\n  const setCameraControl = useCallback((cameraControl: CameraControlData) => {\n    store.update((s) => {\n      s.cameraControl = cameraControl;\n    });\n  }, []);\n  const resetView = useCallback(() => {\n    setCameraControl(DEFAULT_CAMERA_CONTROL);\n  }, [setCameraControl]);\n\n  const markers = store.useState((s) => s.markers);\n  const meteors = store.useState((s) => s.meteors);\n  const selectedMeteor = store.useState((s) => s.selectedMeteor);\n  const selectMeteor = (m: MeteorData, focus: boolean) => {\n    console.info(\"SELECT\", m);\n    store.update((s) => {\n      s.selectedMeteor = m;\n      if (focus) s.cameraControl = focusedMeteorCameraControl(m);\n    });\n  };\n  const focusedMeteorCameraControl = (m: MeteorData) => {\n    const { latitude, longitude } = m.end;\n    return {\n      minDistance: 100,\n      maxDistance: 10000,\n      target: xyz(m.end),\n      up: localUp(latitude, longitude),\n    };\n  };\n  const focusMeteor = (m: MeteorData) => {\n    console.info(\"FOCUS\", m);\n    store.update((s) => {\n      s.cameraControl = focusedMeteorCameraControl(m);\n    });\n  };\n\n  const filter = store.useState((s) => s.filter);\n\n  useEffect(initCameras, []);\n\n  const { gmn } = useGMN();\n\n  const tryLoadMeteors = useCallback(\n    (info: MeteorDataInfo) => {\n      loadMeteors(info)\n        .then(() => {\n          resetView();\n        })\n        .catch((e) => {\n          console.error(\"loading\", info, e);\n          setError(`Failed to load ${info.title}`);\n        });\n    },\n    [resetView]\n  );\n\n  useEffect(() => {\n    tryLoadMeteors(meteorDataInfoFromParams(queryParams));\n  }, [tryLoadMeteors]);\n\n  const [filterVisible, setFilterVisible] = useState(false);\n  const meteorVisibility = filterMeteors(filter, meteors);\n\n  const [settingsVisible, setSettingsVisible] = useState(false);\n  const settings = store.useState((s) => s.settings);\n  store.subscribe((s) => s.settings, saveSettings);\n\n  const Header = () => {\n    const loading = store.useState((s) => s.loading);\n    const title = store.useState((s) => s.meteorDataInfo.title);\n    const numMeteors = store.useState((s) => s.meteors.length);\n    const numVisibleMeteors = meteorVisibility.filter((v) => v).length;\n    const [menuVisible, setMenuVisible] = useState(false);\n    const [menuAnchorEl, setMenuAnchorEl] = useState<HTMLElement | null>(null);\n    const [loadDailyMeteorsDialogOpen, setLoadDailyMeteorsDialogOpen] =\n      useState(false);\n\n    const titleSuffix = () => {\n      const n = formatter.format(numMeteors);\n      if (numMeteors === numVisibleMeteors) {\n        switch (numMeteors) {\n          case 1:\n            return \"1 meteor\";\n          default:\n            return `${n} meteors`;\n        }\n      }\n      const v = formatter.format(numVisibleMeteors);\n      switch (numMeteors) {\n        case 1:\n          return \"0 of 1 meteor\";\n        default:\n          return `${v} of ${n} meteors`;\n      }\n    };\n\n    return (\n      <>\n        <AppBar color=\"transparent\" sx={{ boxShadow: \"none\" }}>\n          <Toolbar sx={{ justifyContent: \"space-between\" }}>\n            <Box\n              sx={{\n                display: \"flex\",\n                justifyContent: \"flex-start\",\n                flexGrow: 1,\n              }}\n            >\n              <IconButton\n                onClick={(event) => {\n                  setMenuVisible(!menuVisible);\n                  setMenuAnchorEl(event.currentTarget);\n                }}\n              >\n                <MenuRoundedIcon />\n              </IconButton>\n              <Typography variant=\"h5\" sx={{ flexGrow: 1 }}>\n                {loading && `Loading ${title}...`}\n                {!loading && `${title} — ${titleSuffix()}`}\n              </Typography>\n            </Box>\n            <Tooltip title=\"Filter visible meteors\">\n              <IconButton\n                onClick={(event) => {\n                  setFilterVisible(!filterVisible);\n                }}\n              >\n                <SearchRoundedIcon />\n              </IconButton>\n            </Tooltip>\n          </Toolbar>\n        </AppBar>\n        <AppMenu\n          open={menuVisible}\n          onClose={() => setMenuVisible(false)}\n          anchorEl={menuAnchorEl}\n          onLoadMeteors={(info: MeteorDataInfo) => {\n            tryLoadMeteors(info);\n            setMenuVisible(false);\n          }}\n          showLoadDailyDialog={() => {\n            setLoadDailyMeteorsDialogOpen(true);\n            setMenuVisible(false);\n          }}\n          resetView={() => {\n            resetView();\n            setMenuVisible(false);\n          }}\n        />\n        <LoadDailyMeteorsDialog\n          open={loadDailyMeteorsDialogOpen}\n          onClose={() => setLoadDailyMeteorsDialogOpen(false)}\n          onLoadMeteors={(date) => {\n            const info = gmn.dailyMeteorsInfo(date);\n            console.info(info);\n            tryLoadMeteors(info);\n            setLoadDailyMeteorsDialogOpen(false);\n          }}\n        />\n      </>\n    );\n  };\n\n  return (\n    <>\n      <LocalizationProvider dateAdapter={DateAdapter}>\n        <Snackbar open={error !== undefined}>\n          <Alert severity=\"error\" onClose={() => setError(undefined)}>\n            {error}\n          </Alert>\n        </Snackbar>\n        <Div100vh style={{ display: \"flex\", flexFlow: \"column\" }}>\n          <Header />\n          <Box sx={{ flex: \"1 1 auto\" }}>\n            <Globe\n              markers={[...markers.values()]}\n              meteors={meteors}\n              filteredMeteors={meteorVisibility}\n              selectedMeteor={selectedMeteor}\n              selectMeteor={selectMeteor}\n              settings={settings}\n              cameraControl={cameraControl}\n              setCameraControl={setCameraControl}\n            />\n            {selectedMeteor && (\n              <MeteorInfo\n                meteor={selectedMeteor}\n                focusMeteor={() => {\n                  focusMeteor(selectedMeteor);\n                }}\n              />\n            )}\n          </Box>\n          <Box sx={{ position: \"absolute\", right: 24, bottom: 0 }}>\n            <Tooltip title=\"App settings\">\n              <IconButton\n                onClick={(event) => {\n                  setSettingsVisible(true);\n                }}\n              >\n                <SettingsRoundedIcon />\n              </IconButton>\n            </Tooltip>\n          </Box>\n          <Footer />\n          <Drawer\n            anchor=\"right\"\n            open={filterVisible}\n            onClose={() => {\n              setFilterVisible(false);\n            }}\n            variant=\"persistent\"\n          >\n            <Filter\n              onClose={() => {\n                setFilterVisible(false);\n              }}\n            />\n          </Drawer>\n          <Drawer\n            anchor=\"right\"\n            open={settingsVisible}\n            onClose={() => {\n              setSettingsVisible(false);\n            }}\n          >\n            <Settings\n              onClose={() => {\n                setSettingsVisible(false);\n              }}\n            />\n          </Drawer>\n        </Div100vh>\n      </LocalizationProvider>\n    </>\n  );\n}\n\nfunction Footer() {\n  return (\n    <Typography variant=\"body2\" color=\"text.secondary\" align=\"center\">\n      {\"Copyright © \"}\n      {new Date().getFullYear()}{\" \"}\n      <Link\n        color=\"inherit\"\n        href=\"https://github.com/robagar/meteor-globe\"\n        target=\"_blank\"\n        rel=\"noopener\"\n      >\n        Rob Agar\n      </Link>\n      {\" (UK003C) \"}\n      {\" — \"}\n      {\"Meteor data from the \"}\n      <Link\n        color=\"inherit\"\n        href=\"https://globalmeteornetwork.org/\"\n        target=\"_blank\"\n        rel=\"noopener\"\n      >\n        Global Meteor Network\n      </Link>\n    </Typography>\n  );\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\n\nimport CssBaseline from \"@mui/material/CssBaseline\";\nimport { ThemeProvider } from \"@mui/material/styles\";\n\nimport \"@fontsource/roboto\";\n\nimport theme from \"./theme\";\n\nimport \"./index.css\";\nimport App from \"./App\";\nimport { GMNProvider } from \"./GMNProvider\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <ThemeProvider theme={theme}>\n      <CssBaseline />\n      <React.Suspense fallback={<div>Loading... </div>}>\n        <GMNProvider>\n          <App />\n        </GMNProvider>\n      </React.Suspense>\n    </ThemeProvider>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n"],"sourceRoot":""}