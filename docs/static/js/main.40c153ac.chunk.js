(this["webpackJsonpmeteor-globe"]=this["webpackJsonpmeteor-globe"]||[]).push([[0],{115:function(e,t,n){},116:function(e,t,n){},121:function(e,t,n){},122:function(e,t,n){},123:function(e,t,n){},147:function(e,t){},149:function(e,t){},162:function(e,t,n){"use strict";n.r(t);var r=n(2),a=n.n(r),o=n(50),i=n.n(o),c=n(189),s=n(187),l=(n(112),n(101)),u=Object(l.a)({palette:{mode:"dark"}}),d=(n(115),n(14)),j=n(186),b=n(190),h=n(191),f=n(184),m=n(192),v=n(95),x=n(9),p=n(16),g=n(177),O=n(188),M=6371.37;function w(e){return Math.PI*e/180}function y(e,t,n){var r=w(e),a=w(t),o=n+M;return[o*Math.cos(r)*Math.cos(-a),o*Math.sin(r),o*Math.cos(r)*Math.sin(-a)]}function k(e){var t=e.latitude,n=e.longitude,r=e.height,a=w(t),o=w(n),i=M+r;return[i*Math.cos(a)*Math.cos(-o),i*Math.sin(a),i*Math.cos(a)*Math.sin(-o)]}var C=n(12),_=n(17),S=n(6),N=n(176),P=(n(116),n(7));function U(e){var t=e.meteor,n=t.showerCode,r=t.beginTime,a=t.magnitude,o=t.duration,i=t.stationCodes;return Object(P.jsxs)("div",{className:"root",children:[Object(P.jsx)("div",{className:"shower",children:n}),Object(P.jsx)("div",{className:"beginTime",children:r}),Object(P.jsxs)("div",{className:"magnitude",children:["Mag ",a]}),Object(P.jsxs)("div",{className:"duration",children:[o,"s"]}),Object(P.jsx)("div",{className:"stationCodes",children:i.join(", ")})]})}var I=new S.Color("white"),T=new S.Color("goldenrod"),F=new S.Color("hotpink");function L(e){var t=e.data,n=e.selectedMeteor,a=e.selectMeteor,o=Object(r.useRef)();Object(p.b)((function(e){var r=e.camera,a=o.current;if(a){var i,c=Object(_.a)(t);try{for(c.s();!(i=c.n()).done;){var s=i.value,l=s.index;a.setMatrixAt(l,E(s,r.position));var d=I;s===n?d=F:l===u.current&&(d=T),a.setColorAt(l,d)}}catch(j){c.e(j)}finally{c.f()}a.instanceMatrix.needsUpdate=!0,a.instanceColor&&(a.instanceColor.needsUpdate=!0)}}));var i=Object(r.useState)(void 0),c=Object(C.a)(i,2),s=c[0],l=c[1],u=Object(r.useRef)(),d=Object(p.d)().invalidate;return Object(P.jsx)(P.Fragment,{children:t.length&&Object(P.jsxs)("instancedMesh",{ref:o,args:[void 0,void 0,t.length],onClick:function(e){var n=e.instanceId;void 0!==n&&(a(t[n]),d())},onPointerOver:function(e){var n=e.instanceId;void 0!==n&&(l(t[n]),u.current!==n&&(u.current=n))},onPointerOut:function(e){l(void 0),u.current===e.instanceId&&(u.current=void 0)},children:[Object(P.jsx)("planeGeometry",{args:[1,1]}),Object(P.jsx)("shaderMaterial",{vertexShader:"\n    varying vec2 vUv;\n    varying vec3 vColor;\n\n    void main() {\n      vUv = uv;\n      vColor = instanceColor;\n      gl_Position = projectionMatrix * modelViewMatrix * instanceMatrix * vec4(position,1.0);\n    }\n  ",fragmentShader:"\n    varying vec2 vUv;\n    varying vec3 vColor;\n\n    void main() {\n      float x = vUv.x;\n      float y = vUv.y;\n      float c = (x < 0.5 ? x : (1.0 - x)) * 2.0;\n      float p = 0.75;\n      float l = y < p ? (y / p) : (1.0 - y) / (1.0 - p);\n      float opacity = c * l;\n      gl_FragColor = vec4(vColor, opacity);\n    }\n  ",transparent:!0,depthWrite:!1}),s&&Object(P.jsx)(N.a,{calculatePosition:function(e,t,n){return function(e,t,n,r){var a=r();if(!(e.parent instanceof S.InstancedMesh&&void 0!==a))return[-9999999,-9999999];e.parent.getMatrixAt(a,z);var o=D.setFromMatrixPosition(z);o.project(t);var i=n.width/2,c=n.height/2;return[o.x*i+i,-o.y*c+c]}(e,t,n,(function(){return u.current}))},children:Object(P.jsx)(U,{meteor:s})})]})})}var D=new S.Vector3,z=new S.Matrix4;function E(e,t){var n=e.begin,r=e.end,a=1-.2*e.magnitude,o=k(n),i=k(r),c=Object(C.a)(o,3),s=c[0],l=c[1],u=c[2],d=Object(C.a)(i,3),j=[(s+d[0])/2,(l+d[1])/2,(u+d[2])/2],b=j[0],h=j[1],f=j[2],m=new S.Vector3(b,h,f),v=new S.Vector3(i[0]-o[0],i[1]-o[1],i[2]-o[2]),x=v.length(),p=Math.max(.1,2*a),g=v.clone();g.normalize();var O=m.clone().sub(t).normalize(),M=g.clone().cross(O).normalize(),w=g.clone().cross(M).normalize(),y=g.clone().cross(w),_=new S.Matrix4,N=y,P=g,U=w;_.makeBasis(N,P,U);var I=new S.Quaternion;I.setFromRotationMatrix(_);var T=new S.Vector3(p,x,1),F=new S.Matrix4;return F.compose(m,I,T),F}n(121);function R(e){var t=e.meteors,n=e.selectedMeteor,r=e.selectMeteor,a={fov:75,near:10,far:1e5,position:y(50.22,-4.95,1500)},o=Object(g.a)({map:"/meteor-globe/textures/2_no_clouds_4k.jpeg",bumpMap:"/meteor-globe/textures/elev_bump_4k.jpeg",specularMap:"/meteor-globe/textures/water_4k.png"});return Object(P.jsxs)(p.a,{className:"globeCanvas",frameloop:"demand",camera:a,children:[Object(P.jsx)(O.a,{minDistance:6571.37,maxDistance:16371.369999999999,zoomSpeed:.1,rotateSpeed:.1}),Object(P.jsx)("ambientLight",{intensity:.1}),Object(P.jsx)("directionalLight",{color:"white",position:y(0,0,1)}),Object(P.jsxs)("mesh",{children:[Object(P.jsx)("sphereGeometry",{args:[M,128,128]}),Object(P.jsx)("meshPhongMaterial",Object(x.a)({},o))]}),Object(P.jsx)(L,{data:t,selectedMeteor:n,selectMeteor:r})]})}n(122);function V(e){var t=e.meteor,n=t.showerCode,r=t.beginTime,a=t.magnitude,o=t.duration,i=t.stationCodes;return Object(P.jsxs)("div",{className:"root",children:[Object(P.jsx)("div",{className:"shower",children:n}),Object(P.jsx)("div",{className:"beginTime",children:r}),Object(P.jsxs)("div",{className:"magnitude",children:["Mag ",a]}),Object(P.jsxs)("div",{className:"duration",children:[o,"s"]}),Object(P.jsx)("div",{className:"stationCodes",children:i.join(", ")})]})}n(123);var A=n(102),G=n(27);Object(G.c)();var K=new A.a({highlightedMarker:"",markers:new Map([["UK003C",{identifier:"UK003C",latitude:50.224871,longitude:-4.949858,label:"UK003C"}]]),meteorDataInfo:{url:"",title:"Loading meteors..."},meteors:[],selectedMeteor:void 0}),B=n(15),J=n.n(B),Y=n(26),H=n(98),Q=n.n(H);function W(){return(W=Object(Y.a)(J.a.mark((function e(t){var n,r,a;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:if(!(n=e.sent).ok){e.next=11;break}return e.next=6,n.text();case 6:return r=e.sent,a=Q()(r,{columns:!0}),e.abrupt("return",a.map((function(e){return{identifier:e.camera_id,latitude:e.obs_latitude,longitude:e.obs_longitude}})));case 11:return e.abrupt("return",Promise.reject(n.statusText));case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(){(function(e){return W.apply(this,arguments)})("/meteor-globe/data/cameradetails.csv").then((function(e){console.info("[cameras]",e),K.update((function(t){var n,r=t.markers,a=Object(_.a)(e);try{for(a.s();!(n=a.n()).done;){var o=n.value;r.set(o.identifier,Object(x.a)(Object(x.a)({},o),{},{label:o.identifier}))}}catch(i){a.e(i)}finally{a.f()}}))})).catch((function(e){console.error("[cameras] load failed",e)}))}var X=n(99),Z=n(100);function $(e){var t=function(e){var t=e.get("test");if(null!==t)switch(t){case"one_perseid":return{url:"/meteor-globe/data/one_perseid.txt",title:"Test - One Perseid"};default:return{url:"/meteor-globe/data/traj_summary_20210812_solrange_140.0-141.0.txt",title:"Test - Lots of Perseids"}}return{url:"https://globalmeteornetwork.org/data/traj_summary_data/daily/traj_summary_yesterday.txt",title:"Yesterday"}}(e);(function(e){var t,n,r,a,o,i,c,s;return J.a.async((function(l){for(;;)switch(l.prev=l.next){case 0:t=[],n=0,r=!1,a=!1,l.prev=4,i=function(){var e=s.value;if(0===e.length)return"continue";if("\r"===e[0]&&(e=e.slice(1)),"#"===e[0])return"continue";var r=e.split(";");if(83!==r.length)return"continue";var a=function(e){var t=r[e];return t?t.trim():""},o=function(e){return parseFloat(a(e))},i=a(1),c=a(3),l={latitude:o(60),longitude:o(62),height:o(64)},u={latitude:o(66),longitude:o(68),height:o(70)},d=o(58),j=o(72),b=o(73),h=o(74),f=o(76),m=a(82).split(",");t.push({index:n++,beginTime:i,showerCode:c,begin:l,end:u,peakHeight:h,magnitude:b,duration:j,mass:f,averageSpeed:d,stationCodes:m})},c=Object(X.a)(Object(Z.a)(e));case 7:return l.next=9,J.a.awrap(c.next());case 9:if(!(r=!(s=l.sent).done)){l.next=16;break}if("continue"!==i()){l.next=13;break}return l.abrupt("continue",13);case 13:r=!1,l.next=7;break;case 16:l.next=22;break;case 18:l.prev=18,l.t0=l.catch(4),a=!0,o=l.t0;case 22:if(l.prev=22,l.prev=23,!r||null==c.return){l.next=27;break}return l.next=27,J.a.awrap(c.return());case 27:if(l.prev=27,!a){l.next=30;break}throw o;case 30:return l.finish(27);case 31:return l.finish(22);case 32:return l.abrupt("return",t);case 33:case"end":return l.stop()}}),null,null,[[4,18,22,32],[23,,27,31]],Promise)})(t.url).then((function(e){K.update((function(n){n.meteorDataInfo=t,n.meteors=e}))})).catch((function(e){throw console.error("[meteors] fetch failed",e),e}))}var ee=new Intl.NumberFormat;function te(){var e=K.useState((function(e){return e.meteorDataInfo.title})),t=K.useState((function(e){return e.meteors.length}));return Object(P.jsx)(j.a,{color:"transparent",sx:{boxShadow:"none"},children:Object(P.jsx)(b.a,{children:Object(P.jsxs)(h.a,{variant:"h6",component:"div",sx:{flexGrow:1},children:[e,1===t&&" \u2014 1 meteor",t>1&&" \u2014 ".concat(ee.format(t)," meteors")]})})})}function ne(){return Object(P.jsxs)(h.a,{variant:"body2",color:"text.secondary",align:"center",children:["Copyright \xa9 ",(new Date).getFullYear()," ",Object(P.jsx)(f.a,{color:"inherit",href:"https://github.com/robagar/meteor-globe",target:"_blank",rel:"noopener",children:"Rob Agar"})," (UK003C) "," \u2014 ","Meteor data from the ",Object(P.jsx)(f.a,{color:"inherit",href:"https://globalmeteornetwork.org/",target:"_blank",rel:"noopener",children:"Global Meteor Network"})]})}function re(){var e=new URLSearchParams(window.location.search),t=K.useState((function(e){return e.markers})),n=K.useState((function(e){return e.meteors})),a=K.useState((function(e){return e.selectedMeteor}));return Object(r.useEffect)(q,[]),Object(r.useEffect)((function(){return $(e)})),Object(P.jsxs)(v.a,{style:{display:"flex",flexFlow:"column"},children:[Object(P.jsx)(te,{}),Object(P.jsxs)(m.a,{sx:{flex:"1 1 auto"},children:[Object(P.jsx)(R,{markers:Object(d.a)(t.values()),meteors:n,selectedMeteor:a,selectMeteor:function(e){console.info("SELECT",e),K.update((function(t){t.selectedMeteor=e}))}}),a&&Object(P.jsx)(V,{meteor:a})]}),Object(P.jsx)(ne,{})]})}i.a.render(Object(P.jsx)(a.a.StrictMode,{children:Object(P.jsxs)(s.a,{theme:u,children:[Object(P.jsx)(c.a,{}),Object(P.jsx)(a.a.Suspense,{fallback:Object(P.jsx)("div",{children:"Loading... "}),children:Object(P.jsx)(re,{})})]})}),document.getElementById("root"))}},[[162,1,2]]]);
//# sourceMappingURL=main.40c153ac.chunk.js.map