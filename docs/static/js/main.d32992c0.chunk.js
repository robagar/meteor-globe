(this["webpackJsonpmeteor-globe"]=this["webpackJsonpmeteor-globe"]||[]).push([[0],{102:function(e,t){},104:function(e,t){},113:function(e,t,n){"use strict";n.r(t);var r=n(5),a=n.n(r),i=n(28),o=n.n(i),c=(n(71),n(13)),s=n(7),u=n(15),l=n(116),d=n(117),v=6371.37;function f(e){return Math.PI*e/180}function h(e,t,n){var r=f(e),a=f(t),i=n+v;return[i*Math.cos(r)*Math.cos(-a),i*Math.sin(r),i*Math.cos(r)*Math.sin(-a)]}function m(e){var t=e.latitude,n=e.longitude,r=e.height,a=f(t),i=f(n),o=v+r;return[o*Math.cos(a)*Math.cos(-i),o*Math.sin(a),o*Math.cos(a)*Math.sin(-i)]}var b=n(10),j=n(14),p=n(6),x=n(115),g=(n(72),n(11));function O(e){var t=e.meteor,n=t.showerCode,r=t.beginTime,a=t.magnitude,i=t.duration,o=t.stationCodes;return Object(g.jsxs)("div",{className:"root",children:[Object(g.jsx)("div",{className:"shower",children:n}),Object(g.jsx)("div",{className:"beginTime",children:r}),Object(g.jsxs)("div",{className:"magnitude",children:["Mag ",a]}),Object(g.jsxs)("div",{className:"duration",children:[i,"s"]}),Object(g.jsx)("div",{className:"stationCodes",children:o.join(", ")})]})}var w=new p.Color(1,1,1),M=new p.Color(1,.27,.71);function y(e){var t=e.data,n=Object(r.useRef)();Object(u.b)((function(e){var r=e.camera,a=n.current;if(a){var i,o=Object(j.a)(t);try{for(o.s();!(i=o.n()).done;){var c=i.value,u=c.index;a.setMatrixAt(u,C(c,r.position)),a.setColorAt(u,u===s.current?M:w)}}catch(l){o.e(l)}finally{o.f()}a.instanceMatrix.needsUpdate=!0,a.instanceColor&&(a.instanceColor.needsUpdate=!0)}}));var a=Object(r.useState)(void 0),i=Object(b.a)(a,2),o=i[0],c=i[1],s=Object(r.useRef)();return Object(g.jsx)(g.Fragment,{children:t.length&&Object(g.jsxs)("instancedMesh",{ref:n,args:[void 0,void 0,t.length],onPointerOver:function(e){var n=e.instanceId;void 0!==n&&(c(t[n]),s.current!==n&&(s.current=n))},onPointerOut:function(e){c(void 0),s.current===e.instanceId&&(s.current=void 0)},children:[Object(g.jsx)("planeGeometry",{args:[1,1]}),Object(g.jsx)("shaderMaterial",{vertexShader:"\n    varying vec2 vUv;\n    varying vec3 vColor;\n\n    void main() {\n      vUv = uv;\n      vColor = instanceColor;\n      gl_Position = projectionMatrix * modelViewMatrix * instanceMatrix * vec4(position,1.0);\n    }\n  ",fragmentShader:"\n    varying vec2 vUv;\n    varying vec3 vColor;\n\n    void main() {\n      float x = vUv.x;\n      float y = vUv.y;\n      float c = (x < 0.5 ? x : (1.0 - x)) * 2.0;\n      float p = 0.75;\n      float l = y < p ? (y / p) : (1.0 - y) / (1.0 - p);\n      float opacity = c * l;\n      gl_FragColor = vec4(vColor, opacity);\n    }\n  ",transparent:!0,depthWrite:!1}),o&&Object(g.jsx)(x.a,{calculatePosition:function(e,t,n){return function(e,t,n,r){var a=r();if(!(e.parent instanceof p.InstancedMesh&&void 0!==a))return[-9999999,-9999999];e.parent.getMatrixAt(a,_);var i=k.setFromMatrixPosition(_);i.project(t);var o=n.width/2,c=n.height/2;return[i.x*o+o,-i.y*c+c]}(e,t,n,(function(){return s.current}))},children:Object(g.jsx)(O,{meteor:o})})]})})}var k=new p.Vector3,_=new p.Matrix4;function C(e,t){var n=e.begin,r=e.end,a=1-.2*e.magnitude,i=m(n),o=m(r),c=Object(b.a)(i,3),s=c[0],u=c[1],l=c[2],d=Object(b.a)(o,3),v=[(s+d[0])/2,(u+d[1])/2,(l+d[2])/2],f=v[0],h=v[1],j=v[2],x=new p.Vector3(f,h,j),g=new p.Vector3(o[0]-i[0],o[1]-i[1],o[2]-i[2]),O=g.length(),w=Math.max(.1,2*a),M=g.clone();M.normalize();var y=x.clone().sub(t).normalize(),k=M.clone().cross(y).normalize(),_=M.clone().cross(k).normalize(),C=M.clone().cross(_),U=new p.Matrix4,P=C,S=M,N=_;U.makeBasis(P,S,N);var z=new p.Quaternion;z.setFromRotationMatrix(U);var F=new p.Vector3(w,O,1),I=new p.Matrix4;return I.compose(x,z,F),I}n(77);function U(e){var t=e.meteors,n={fov:75,near:10,far:1e5,position:h(50.22,-4.95,1500)},r=Object(l.a)({map:"/meteor-globe/textures/2_no_clouds_4k.jpeg",bumpMap:"/meteor-globe/textures/elev_bump_4k.jpeg",specularMap:"/meteor-globe/textures/water_4k.png"});return Object(g.jsxs)(u.a,{className:"globeCanvas",frameloop:"demand",camera:n,children:[Object(g.jsx)(d.a,{minDistance:6571.37,maxDistance:16371.369999999999,zoomSpeed:.1,rotateSpeed:.1}),Object(g.jsx)("ambientLight",{intensity:.1}),Object(g.jsx)("directionalLight",{color:"white",position:h(0,0,1)}),Object(g.jsxs)("mesh",{children:[Object(g.jsx)("sphereGeometry",{args:[v,128,128]}),Object(g.jsx)("meshPhongMaterial",Object(s.a)({},r))]}),Object(g.jsx)(y,{data:t})]})}n(78);var P=n(66),S=n(18);Object(S.c)();var N=new P.a({highlightedMarker:"",markers:new Map([["UK003C",{identifier:"UK003C",latitude:50.224871,longitude:-4.949858,label:"UK003C"}]]),meteors:[]}),z=n(12),F=n.n(z),I=n(17),V=n(63),A=n.n(V);function L(){return(L=Object(I.a)(F.a.mark((function e(t){var n,r,a;return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:if(!(n=e.sent).ok){e.next=11;break}return e.next=6,n.text();case 6:return r=e.sent,a=A()(r,{columns:!0}),e.abrupt("return",a.map((function(e){return{identifier:e.camera_id,latitude:e.obs_latitude,longitude:e.obs_longitude}})));case 11:return e.abrupt("return",Promise.reject(n.statusText));case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(){(function(e){return L.apply(this,arguments)})("/meteor-globe/data/cameradetails.csv").then((function(e){console.info("[cameras]",e),N.update((function(t){var n,r=t.markers,a=Object(j.a)(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;r.set(i.identifier,Object(s.a)(Object(s.a)({},i),{},{label:i.identifier}))}}catch(o){a.e(o)}finally{a.f()}}))})).catch((function(e){console.error("[cameras] load failed",e)}))}var T=n(64),E=n(65);function K(e){(function(e){var t,n,r,a,i,o,c,s;return F.a.async((function(u){for(;;)switch(u.prev=u.next){case 0:t=[],n=0,r=!1,a=!1,u.prev=4,o=function(){var e=s.value;if(0===e.length)return"continue";if("\r"===e[0]&&(e=e.slice(1)),"#"===e[0])return"continue";var r=e.split(";");if(83!==r.length)return"continue";var a=function(e){var t=r[e];return t?t.trim():""},i=function(e){return parseFloat(a(e))},o=a(1),c=a(3),u={latitude:i(60),longitude:i(62),height:i(64)},l={latitude:i(66),longitude:i(68),height:i(70)},d=i(72),v=i(73),f=i(74),h=i(76),m=a(82).split(",");t.push({index:n++,beginTime:o,showerCode:c,begin:u,end:l,peakHeight:f,magnitude:v,duration:d,mass:h,stationCodes:m})},c=Object(T.a)(Object(E.a)(e));case 7:return u.next=9,F.a.awrap(c.next());case 9:if(!(r=!(s=u.sent).done)){u.next=16;break}if("continue"!==o()){u.next=13;break}return u.abrupt("continue",13);case 13:r=!1,u.next=7;break;case 16:u.next=22;break;case 18:u.prev=18,u.t0=u.catch(4),a=!0,i=u.t0;case 22:if(u.prev=22,u.prev=23,!r||null==c.return){u.next=27;break}return u.next=27,F.a.awrap(c.return());case 27:if(u.prev=27,!a){u.next=30;break}throw i;case 30:return u.finish(27);case 31:return u.finish(22);case 32:return u.abrupt("return",t);case 33:case"end":return u.stop()}}),null,null,[[4,18,22,32],[23,,27,31]],Promise)})(function(e){var t=e.get("test");if(null!==t)switch(t){case"one_perseid":return"/meteor-globe/data/one_perseid.txt";default:return"/meteor-globe/data/traj_summary_20210812_solrange_140.0-141.0.txt"}return"https://globalmeteornetwork.org/data/traj_summary_data/daily/traj_summary_yesterday.txt"}(e)).then((function(e){N.update((function(t){t.meteors=e}))})).catch((function(e){throw console.error("[meteors] fetch failed",e),e}))}var B=function(){var e=new URLSearchParams(window.location.search),t=N.useState((function(e){return e.markers})),n=N.useState((function(e){return e.meteors}));return Object(r.useEffect)(R,[]),Object(r.useEffect)((function(){return K(e)})),Object(g.jsx)("div",{className:"App",children:Object(g.jsx)(U,{markers:Object(c.a)(t.values()),meteors:n})})};o.a.render(Object(g.jsx)(a.a.StrictMode,{children:Object(g.jsx)(a.a.Suspense,{fallback:Object(g.jsx)("div",{children:"Loading... "}),children:Object(g.jsx)(B,{})})}),document.getElementById("root"))},71:function(e,t,n){},72:function(e,t,n){},77:function(e,t,n){},78:function(e,t,n){}},[[113,1,2]]]);
//# sourceMappingURL=main.d32992c0.chunk.js.map